# Внешние интеграции

- [Внешние интеграции](#внешние-интеграции)
  - [Диаграмма контекста](#диаграмма-контекста)
  - [Диаграмма контейнеров](#диаграмма-контейнеров)
  - [Список требований, которым должны удовлетворить внешние интеграции](#список-требований-которым-должны-удовлетворить-внешние-интеграции)
    - [Требования к безопасности](#требования-к-безопасности)
    - [Протоколы аутентификации и авторизации](#протоколы-аутентификации-и-авторизации)
    - [Взаимодействие между системами предприятия и внешней платформой](#взаимодействие-между-системами-предприятия-и-внешней-платформой)

## Диаграмма контекста
Функционал умного дома будет интегрирован внутрь существующей системы для собственников. Внутри ней же будут обсепечены дополнителньные меры по работе с персональными данными

![c4_context](C4_context_diagram.drawio.svg)

## Диаграмма контейнеров

Изменения, которые предлагается сделать в ландшафте систем кампании в связи с внедрением новых бизнес-функций, выделены фиолетовым цветом. Все изменения направлены на то, чтобы соблюсти требования к защите персональных и биометрических данных и расширить функциональность приложения для собственников

![c4_container](C4_container_diagram.drawio.svg)


## Список требований, которым должны удовлетворить внешние интеграции

### Требования к безопасности

1. Анонимизация (псевдонимизация) данных
   - При передаче во внешние системы пользовательские данные (фотографии лиц, номера машин) должны быть максимально обезличены (хранить ключи соответствия отдельно)
   - Для аналитики фотографии/номера не должны напрямую связываться с другими идентифицирующими сведениями.
2. Контроль доступа внутри PropDevelopment
   - Должны быть установлены чёткие роли и права (по принципу минимальных привилегий) для сотрудников, имеющих доступ к сервисам Умный дом и соответствующим данным (особенно к биометрии)
3. Соблюдение нормативных требований
   - Система должна соответствовать ФЗ-152 «О персональных данных» (включая особый статус биометрических данных) и другим применимым актам
   - Хранение фотографий/номеров на серверах в РФ
4. Права пользователей на изменение/удаление данных
   - Собственники должны иметь возможность просматривать свои биометрические данные (либо их наличие) и по запросу удалять/изменять их (если это не противоречит обязательным требованиям, например, охране правопорядка).
5. Информирование и согласие
   - Перед использованием биометрии и других персональных данных пользователь должен явно дать согласие, зная цели и условия обработки
6. Шифрование данных и ведение журнала
   - Хранение фотографий, номеров машин и любых персональных данных в зашифрованном виде (как в базе, так и в резервных копиях)
   - Передача данных через TLS (либо эквивалентный защищённый канал)
   - Журналы операций также шифруются и хранятся отдельно
7. Управление ключами
   - Ключи шифрования хранятся централизованно (желательно в HSM или безопасном контуре)
   - Реализованы процессы ротации ключей и ограничения доступа к ним
8. Мониторинг и реагирование на инциденты
   - Активный мониторинг сетевого трафика, логов приложений, попыток несанкционированного доступа
   - Автоматические уведомления/оповещения при подозрительных действиях или утечках
   - Минимум раз в полгода проводить аудит безопасности и актуализировать политику защиты данных
9. Контроль трафика на утечку ПДн
   - На периметре и в каналах обмена с партнёром использовать DLP/контент-фильтрацию, чтобы случайно не отправлялись лишние персональные данные

### Протоколы аутентификации и авторизации


1. RBAC с принципом минимальных привилегий

   Как внутри компании, так и для внешних партнёров, чтобы сервисам и людям выдавались только те права, которые им необходимы

2. Безопасный канал связи

   Вся сетевая коммуникация между PropDevelopment и сервисом Умный дом должна идти поверх защищённого канала (TLS/VPN/IPSec)

3. OAuth2 или аналог для внешних сервисов

   При интеграции с партнёром следует использовать современный протокол (OAuth2/OpenID Connect) для аутентификации и авторизации сервисов, исключая передачу логинов/паролей напрямую

4. Регулярные проверки прав и аудит

   Как минимум раз в полгода (или год) проводить ревизию прав и контроль корректности настроек в сервисе Умный дом, поскольку он обрабатывает особую категорию (биометрические) данных

5. Мониторинг авторизационных событий

   В случае множественных неудачных попыток доступа или резких изменений прав — генерируется оповещение для специалистов по безопасности


### Взаимодействие между системами предприятия и внешней платформой

1. Асинхронное взаимодействие для отказоустойчивости

    Операции (например, распознавание лиц, номеров) могут выполняться асинхронно, а результат возвращается по callback или в очередь сообщений

1. Контроль содержимого при обмене

    На шлюзе PropDevelopment желательно развернуть слой, который проверяет (DLP) исходящий/входящий поток на предмет персональных данных сверх запрошенных. Это помогает избежать ситуации, когда случайно утекают лишние поля (ФИО, контактные данные).

1. Соглашение об уровнях доступности (SLA) и ответственности

    В договоре с внешним партнёром прописать, какие данные кто обрабатывает и кто несёт ответственность за защиту. Указать гарантии доступности сервиса Умный дом и временные окна обслуживания (MTTR, MTBF)

1. Регламенты на случай отказа или сбоя у партнёра

    Если распознавание лиц/номеров недоступно, у собственников должны оставаться альтернативные способы входа (классические ключи, кодовые замки и т.д.). Не допустить полной блокировки входа в дом при падении внешнего сервиса

1. Двусторонняя отчётность и логирование

    Каждая сторона (PropDevelopment и поставщик Умного дома) должна вести логи взаимодействия и в случае инцидентов предоставлять их для расследования. Желательно установить единый формат (например, JSON) и единое время (NTP-сервер) для корректной корреляции событий
